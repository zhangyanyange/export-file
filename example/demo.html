<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>axios-file-export æµè§ˆå™¨ç¤ºä¾‹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 32px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 16px;
    }

    .example-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      border-left: 4px solid #667eea;
    }

    .example-section h2 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 20px;
    }

    .example-section p {
      color: #555;
      margin-bottom: 15px;
      line-height: 1.6;
    }

    .input-group {
      margin-bottom: 15px;
    }

    .input-group label {
      display: block;
      color: #555;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .input-group input {
      width: 100%;
      padding: 10px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    .input-group input:focus {
      outline: none;
      border-color: #667eea;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .result {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      display: none;
    }

    .result.error {
      background: #ffebee;
      border-left-color: #f44336;
    }

    .result.show {
      display: block;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .result-title {
      font-weight: 600;
      margin-bottom: 5px;
      color: #333;
    }

    .result-content {
      color: #555;
      font-size: 14px;
    }

    code {
      background: #f5f5f5;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸš€ axios-file-export</h1>
    <p class="subtitle">æµè§ˆå™¨ç¯å¢ƒä½¿ç”¨ç¤ºä¾‹</p>

    <!-- ç¤ºä¾‹1: ä½¿ç”¨æ—¶é—´æˆ³å‘½å -->
    <div class="example-section">
      <h2>ç¤ºä¾‹1: ä½¿ç”¨æ—¶é—´æˆ³å‘½åä¸‹è½½PDF</h2>
      <p>ç‚¹å‡»æŒ‰é’®ä¸‹è½½ç¤ºä¾‹PDFæ–‡ä»¶ï¼Œæ–‡ä»¶åå°†ä½¿ç”¨æ—¶é—´æˆ³è‡ªåŠ¨ç”Ÿæˆã€‚</p>
      <button onclick="example1()">ä¸‹è½½PDF (æ—¶é—´æˆ³å‘½å)</button>
      <div id="result1" class="result">
        <div class="result-title">ç»“æœ:</div>
        <div class="result-content" id="result1-content"></div>
      </div>
    </div>

    <!-- ç¤ºä¾‹2: è‡ªå®šä¹‰æ–‡ä»¶å -->
    <div class="example-section">
      <h2>ç¤ºä¾‹2: è‡ªå®šä¹‰æ–‡ä»¶å</h2>
      <p>æŒ‡å®šè‡ªå®šä¹‰æ–‡ä»¶åï¼Œæ‰©å±•åå°†æ ¹æ®æ–‡ä»¶ç±»å‹è‡ªåŠ¨æ·»åŠ ã€‚</p>
      <div class="input-group">
        <label for="customFilename">æ–‡ä»¶å:</label>
        <input type="text" id="customFilename" placeholder="my-document" value="my-document">
      </div>
      <button onclick="example2()">ä¸‹è½½å¹¶ä½¿ç”¨è‡ªå®šä¹‰æ–‡ä»¶å</button>
      <div id="result2" class="result">
        <div class="result-title">ç»“æœ:</div>
        <div class="result-content" id="result2-content"></div>
      </div>
    </div>

    <!-- ç¤ºä¾‹3: å¸¦å‚æ•°çš„GETè¯·æ±‚ -->
    <div class="example-section">
      <h2>ç¤ºä¾‹3: å¸¦å‚æ•°çš„GETè¯·æ±‚</h2>
      <p>é€šè¿‡URLå‚æ•°è¯·æ±‚ç‰¹å®šæ ¼å¼çš„æŠ¥è¡¨ã€‚</p>
      <button onclick="example3()">ä¸‹è½½ExcelæŠ¥è¡¨</button>
      <div id="result3" class="result">
        <div class="result-title">ç»“æœ:</div>
        <div class="result-content" id="result3-content"></div>
      </div>
    </div>

    <!-- ç¤ºä¾‹4: ä¸‹è½½å›¾ç‰‡ -->
    <div class="example-section">
      <h2>ç¤ºä¾‹4: ä¸‹è½½å›¾ç‰‡</h2>
      <p>ä¸‹è½½å›¾ç‰‡æ–‡ä»¶ï¼Œè‡ªåŠ¨æ£€æµ‹å›¾ç‰‡æ ¼å¼ã€‚</p>
      <button onclick="example4()">ä¸‹è½½ç¤ºä¾‹å›¾ç‰‡</button>
      <div id="result4" class="result">
        <div class="result-title">ç»“æœ:</div>
        <div class="result-content" id="result4-content"></div>
      </div>
    </div>

    <!-- ç¤ºä¾‹5: ç”¨æˆ·æŒ‡å®šæ‰©å±•å (v1.1.0æ–°åŠŸèƒ½) -->
    <div class="example-section">
      <h2>ç¤ºä¾‹5: ç”¨æˆ·æŒ‡å®šæ‰©å±•å âœ¨ <code style="background: #667eea; color: white; padding: 3px 8px;">v1.1.0</code></h2>
      <p>ğŸ¯ <strong>æ–°åŠŸèƒ½</strong>: å½“æ‚¨æä¾›å¸¦æ‰©å±•åçš„æ–‡ä»¶åæ—¶ï¼Œæ’ä»¶å°†ç›´æ¥ä½¿ç”¨è¯¥æ‰©å±•åï¼Œä¸è¿›è¡Œæ–‡ä»¶ç±»å‹æ£€æµ‹ã€‚è¿™æ ·å¯ä»¥é¿å…å› APIè¿”å›çš„Content-Typeä¸å‡†ç¡®è€Œå¯¼è‡´çš„æ‰©å±•åé”™è¯¯ã€‚</p>
      <div class="input-group">
        <label for="filenameWithExt">æ–‡ä»¶åï¼ˆå«æ‰©å±•åï¼‰:</label>
        <input type="text" id="filenameWithExt" placeholder="report.pdf" value="my-report.pdf">
      </div>
      <p style="font-size: 13px; color: #888; margin-top: -10px;">ğŸ’¡ æç¤º: æ’ä»¶ä¼šç›´æ¥ä½¿ç”¨ <code>.pdf</code> æ‰©å±•åï¼Œä¸ä¼šæ£€æµ‹æ–‡ä»¶ç±»å‹</p>
      <button onclick="example5()">ä¸‹è½½ï¼ˆä½¿ç”¨æŒ‡å®šæ‰©å±•åï¼‰</button>
      <div id="result5" class="result">
        <div class="result-title">ç»“æœ:</div>
        <div class="result-content" id="result5-content"></div>
      </div>
    </div>
  </div>

  <!-- å¼•å…¥axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>

  <!-- å¼•å…¥æˆ‘ä»¬çš„åº“ï¼ˆå¼€å‘ç¯å¢ƒä¸­ï¼Œéœ€è¦å…ˆæ„å»ºæˆ–ä½¿ç”¨æ¨¡å—åŠ è½½å™¨ï¼‰ -->
  <script type="module">
    // æ³¨æ„: åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæ‚¨éœ€è¦å¯¼å…¥æ„å»ºåçš„æ–‡ä»¶æˆ–ä½¿ç”¨æ‰“åŒ…å·¥å…·
    // è¿™é‡Œæ˜¯æ¼”ç¤ºä»£ç ç»“æ„

    // ç”±äºè¿™æ˜¯ç¤ºä¾‹HTMLï¼Œæˆ‘ä»¬æ¨¡æ‹ŸexportFileå‡½æ•°
    // åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ‚¨åº”è¯¥è¿™æ ·å¯¼å…¥: import { exportFile } from 'axios-file-export';

    // ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬ä½¿ç”¨å…¬å…±API
    window.example1 = async function () {
      showLoading('result1');
      try {
        // ä½¿ç”¨å…¬å…±PDFç¤ºä¾‹
        const response = await axios({
          url: 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
          method: 'GET',
          responseType: 'blob'
        });

        const blob = new Blob([response.data], { type: 'application/pdf' });
        const timestamp = formatTimestamp();
        const filename = `${timestamp}.pdf`;

        downloadBlob(blob, filename);
        showResult('result1', `æ–‡ä»¶ä¸‹è½½æˆåŠŸ: ${filename}`, false);
      } catch (error) {
        showResult('result1', `ä¸‹è½½å¤±è´¥: ${error.message}`, true);
      }
    };

    window.example2 = async function () {
      const customName = document.getElementById('customFilename').value || 'my-document';
      showLoading('result2');
      try {
        const response = await axios({
          url: 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
          method: 'GET',
          responseType: 'blob'
        });

        const blob = new Blob([response.data], { type: 'application/pdf' });
        const filename = `${customName}.pdf`;

        downloadBlob(blob, filename);
        showResult('result2', `æ–‡ä»¶ä¸‹è½½æˆåŠŸ: ${filename}`, false);
      } catch (error) {
        showResult('result2', `ä¸‹è½½å¤±è´¥: ${error.message}`, true);
      }
    };

    window.example3 = async function () {
      showLoading('result3');
      try {
        // æ¨¡æ‹Ÿä¸‹è½½Excelï¼ˆä½¿ç”¨å…¬å…±APIè¿”å›JSONï¼Œè½¬æ¢ä¸ºblobæ¼”ç¤ºï¼‰
        const response = await axios({
          url: 'https://jsonplaceholder.typicode.com/posts',
          method: 'GET',
          params: { _limit: 10 }
        });

        // å°†JSONè½¬æ¢ä¸ºCSVæ ¼å¼ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰
        const csv = jsonToCSV(response.data);
        const blob = new Blob([csv], { type: 'text/csv' });
        const timestamp = formatTimestamp();
        const filename = `report_${timestamp}.csv`;

        downloadBlob(blob, filename);
        showResult('result3', `æŠ¥è¡¨ä¸‹è½½æˆåŠŸ: ${filename}`, false);
      } catch (error) {
        showResult('result3', `ä¸‹è½½å¤±è´¥: ${error.message}`, true);
      }
    };

    window.example4 = async function () {
      showLoading('result4');
      try {
        const response = await axios({
          url: 'https://picsum.photos/800/600',
          method: 'GET',
          responseType: 'blob'
        });

        const blob = new Blob([response.data], { type: 'image/jpeg' });
        const timestamp = formatTimestamp();
        const filename = `image_${timestamp}.jpg`;

        downloadBlob(blob, filename);
        showResult('result4', `å›¾ç‰‡ä¸‹è½½æˆåŠŸ: ${filename}`, false);
      } catch (error) {
        showResult('result4', `ä¸‹è½½å¤±è´¥: ${error.message}`, true);
      }
    };

    // âœ¨ v1.1.0 æ–°åŠŸèƒ½ç¤ºä¾‹
    window.example5 = async function () {
      const filenameWithExt = document.getElementById('filenameWithExt').value || 'my-report.pdf';
      showLoading('result5');
      try {
        const response = await axios({
          url: 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
          method: 'GET',
          responseType: 'blob'
        });

        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æä¾›äº†æ‰©å±•å
        const hasExtension = /\.[a-zA-Z0-9]+$/.test(filenameWithExt);
        let finalFilename;

        if (hasExtension) {
          // ç”¨æˆ·æä¾›äº†æ‰©å±•åï¼Œç›´æ¥ä½¿ç”¨ï¼ˆv1.1.0æ–°åŠŸèƒ½ï¼‰
          const timestamp = formatTimestamp();
          const lastDotIndex = filenameWithExt.lastIndexOf('.');
          const nameWithoutExt = filenameWithExt.substring(0, lastDotIndex);
          const ext = filenameWithExt.substring(lastDotIndex);
          finalFilename = `${nameWithoutExt}_${timestamp}${ext}`;
        } else {
          // æ²¡æœ‰æ‰©å±•åï¼Œè‡ªåŠ¨æ·»åŠ 
          const timestamp = formatTimestamp();
          finalFilename = `${filenameWithExt}_${timestamp}.pdf`;
        }

        const blob = new Blob([response.data], { type: 'application/pdf' });
        downloadBlob(blob, finalFilename);

        const message = hasExtension
          ? `âœ… æ–‡ä»¶ä¸‹è½½æˆåŠŸ: ${finalFilename}<br>ğŸ¯ ä½¿ç”¨äº†æ‚¨æŒ‡å®šçš„æ‰©å±•åï¼Œæœªè¿›è¡Œæ–‡ä»¶ç±»å‹æ£€æµ‹`
          : `âœ… æ–‡ä»¶ä¸‹è½½æˆåŠŸ: ${finalFilename}<br>âš ï¸ æœªæä¾›æ‰©å±•åï¼Œè‡ªåŠ¨æ·»åŠ äº† .pdf`;

        showResult('result5', message, false);
      } catch (error) {
        showResult('result5', `ä¸‹è½½å¤±è´¥: ${error.message}`, true);
      }
    };

    // è¾…åŠ©å‡½æ•°
    function formatTimestamp() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      return `${year}${month}${day}_${hours}${minutes}${seconds}`;
    }

    function downloadBlob(blob, filename) {
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      link.style.display = 'none';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    function showResult(id, message, isError) {
      const resultDiv = document.getElementById(id);
      const contentDiv = document.getElementById(`${id}-content`);

      resultDiv.className = 'result show';
      if (isError) {
        resultDiv.classList.add('error');
      }

      contentDiv.innerHTML = message;
    }

    function showLoading(id) {
      const resultDiv = document.getElementById(id);
      const contentDiv = document.getElementById(`${id}-content`);

      resultDiv.className = 'result show';
      resultDiv.classList.remove('error');
      contentDiv.textContent = 'æ­£åœ¨ä¸‹è½½...';
    }

    function jsonToCSV(jsonArray) {
      if (!jsonArray || jsonArray.length === 0) return '';

      const headers = Object.keys(jsonArray[0]);
      const csvHeaders = headers.join(',');

      const csvRows = jsonArray.map(obj =>
        headers.map(header => {
          const value = obj[header];
          return typeof value === 'string' ? `"${value}"` : value;
        }).join(',')
      );

      return [csvHeaders, ...csvRows].join('\n');
    }
  </script>
</body>

</html>